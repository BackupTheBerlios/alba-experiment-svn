#!/usr/bin/bash 
if [ -f /etc/make.conf ]; then
	. /etc/make.conf
else
	echo "ERROR /etc/make.conf not found"
	exit 1
fi
EBUILD=$1
if [ -z "$EBUILD" ]; then
	echo "Please specify an ebuild name to copy in '$PORTDIR_OVERLAY'"
	exit 1
fi
CATEGORY=`echo $EBUILD| sed s/-[0-9].*$//`
EBNAME=`echo $EBUILD | cut -d '/' -f 2`
EBFULLNAME=/usr/portage/$CATEGORY/$EBNAME.ebuild
EBSHORTNAME=`echo $EBNAME | sed s/-[0-9].*$//`
EBVER=`echo $EBNAME | sed s/^$EBSHORTNAME//`
echo EBVER $EBVER
EBVER_MAJ=`echo $EBVER | sed s/-r[0-9].*$//`
echo EBVER_MAJ $EBVER_MAJ
EBVER_MIN=`echo $EBVER | sed s/^$EBVER_MAJ//`
echo EBVER_MIN $EBVER_MIN
EBNEWNAME=${EBSHORTNAME}${EBVER_MAJ}-r1100
if [ -f $EBFULLNAME ]; then
	ls -l $EBFULLNAME
	mkdir -p $PORTDIR_OVERLAY/$CATEGORY
	echo "'$EBFULLNAME' => '$PORTDIR_OVERLAY/$CATEGORY/$EBNEWNAME.ebuild'"
	sed '/KEYWORDS=/ {
	s/"$/ x86-sunos"/
	}
	' $EBFULLNAME > $PORTDIR_OVERLAY/$CATEGORY/$EBNEWNAME.ebuild
	cp -vRf /usr/portage/$CATEGORY/files $PORTDIR_OVERLAY/$CATEGORY
	ebuild $PORTDIR_OVERLAY/$CATEGORY/$EBNEWNAME.ebuild digest
else
	echo No such ebuild found
	exit 2
fi
